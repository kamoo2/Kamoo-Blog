---
title: '[JS] 자바스크립트는 어떻게 메모리 관리할까 ?'
description: 메모리 누수의 일반적인 원인과 이를 방지하기 위한 방법을 포함해 자바스크립트 메모리 관리의 전반적인 내용을 학습해보자.
tags:
  - Javascript
createdAt: 2023-11-02 17:00:00
---

## 자바스크립트 메모리 관리의 이해

### 가비지 컬렉션
자바스크립트 엔진은 가비지 컬렉션을 사용해 메모리를 확보한다.
가비지 컬렉션은 변수와 객체를 지속적으로 모니터링 하여 앱에서 더 이상 참조되지 않는 객체를 식별하고 제거하는 역할을 한다.
`표시(mark)`와 `정리(sweep)` 기술을 사용하여 메모리 관리를 한다.
아직 사용 중인 객체를 표시한 다음, 힙을 정리하여 사용 중으로 표시되지 않은 객체를 모두 제거한다.
이 프로세스는 주기적으로 시행되며 힙의 메모리가 부족할 때도 수행되어 앱의 메모리 사용량이 항상 최대한 효율적으로 유지되도록 한다.

### 스택
자바스크립트에는 `Call Stack`이라는 스택으로 만들어진 메모리 공간이 있다.
`Call Stack`은 함수를 실행하는 동안에만 필요한 데이터(실행컨텍스트)가 저장되며 함수가 종료되면 제거된다.
실행컨텍스트에 대해 간단히 설명하자면 함수 실행에 필요한 환경(변수객체,스코프체인,this) 담고 있는 객체이다.
스코프체인으로 연결되어져 있기 때문에 상위 함수의 실행컨텍스트로 접근이 가능하기 때문에 다음과 같이 상위 함수의 변수를 사용할 수 있는 것
```javascript
function parentFunc() {
  let x = 1;
  function childFunc() {
    console.log(x); // x 출력
  }
}
```

### 힙
힙은 스택과 반대로 앱이 실행되는 동안 필요한 전체 데이터를 저장하는데 사용된다.
힙은 여러번 액세스 해야하는 객체, 배열 및 기타 복잡한 데이터 구조를 저장하는 데 사용된다.

## 메모리 누수
메모리 누수는 앱의 성능을 저하시키기 때문에 반드시 방지 해야 한다.
메모리 누수의 일반적인 원인을 이해하여 메모리 누수를 방지해보자

### 1. 순환 참조
메모리 누수의 가장 일반적인 원인 중 하나는 순환 참조라고 함
순환 참조는 두개 이상의 객체가 서로를 참조하여 가비지 컬렌션이 제거 할 수 없는 순환을 생성할 때 발생함
이로 인해 객체가 더 이상 필요하지 않지만 오랫동안 메모리에 유지 되어 성능을 저하시킬 수 있다.

```javascript
let obj1 = {};
let obj2 = {};

obj1.next = obj2;
obj2.prev = obj1;

obj1 = null;
obj2 = null;
```
위 코드를 보면 obj1과 obj2가 서로 참조하고 있기 때문에 순환참조가 발생한다.
`정상적인 동작` obj1과 obj2를 null로 해주면 가비지 컬렉션이 더 이상 사용하지 않는 객체구나 하고 제거됨
`순환 참조` 객체가 더 이상 사용되지 않지만 오랫동안 메모리에 유지되어 메모리 누수가 발생한다.
이 경우에 메모리 누수를 방지하기 위해서는 자바스크립트의 `delete` 키워드를 사용해 순환 참조를 생성하는 프로퍼티를 제거하여 순환참조를 끊는 방법이 있다.

```javascript
delete obj1.next;
delete obj2.prev;
```

### 2. 이벤트 리스터
이벤트 리스너를 Element에 연결하면 리스너 함수에 대한 참조가 생성되어 Element에서 사용되는 메모리를 확보하지 못할 수 있다.
Element가 더 이상 필요하지 않을 때 리스너 함수를 제거해줘야 메모리 누수가 발생하지 않는다.

```javascript
const btn = document.querySelector('.button');

btn.addEventListener('click',()=>{
  console.log('button!');
});

// DOM에서 버튼을 제거
btn.parentNode.removeChild(btn);
```
예제에서 버튼은 이벤트 리스너를 참조하고 있기 때문에 DOM에서 버튼이 제거되더라도 가비지 컬렉션이 해당 메모리를 확보하지 못함
이러한 메모리 누수를 방지하기 위해서는 Element가 더 이상 필요하지 않다면 이벤트 리스너를 제거해야함

```javascript
const btn = document.querySelector('.button');

btn.addEventListener('click',()=>{
  console.log('button!');
});

btn.removeEventListener('click',()=>{});
```

### 3. 전역 변수
전역 변수를 생성하면 코드의 어느 위치에서나 접근할 수 있어 더 이상 필요하지 않은 시점을 판단하기 어려워 변수가 오랫동안 메모리에 유지되는 문제 발생
```javascript
let globalObject = {
  id: 1,
  name : "나는 전역 객체야",
  data : new Array(1000000).fill('어마어마한 메모리 공간...')
};

globalObject = null; // 참조를 끊어 GC에서 제거
```
globalObject는 대량의 데이터 배열을 저장하고 있기 때문에 반드시 더 이상 사용되지 않는다면 메모리에서 제거 해줘야 한다.
그래서 `null`을 저장했지만 전역 객체이므로 오랫동안 메모리에 유지되어 메모리 누수를 일으킬 수 있다.
전역 변수로 인한 메모리 누수 문제를 해결하는 방법으로는 `함수 스코핑` 기법을 사용할 수 있다.

```javascript
function func() {
  let globalObject = {
    id: 1,
    name : "나는 전역 객체야",
    data : new Array(1000000).fill('어마어마한 메모리 공간...')
  };
}

func();
```

이렇게 함수로 감싸주면 함수 스코프 내부에서만 사용할 수 있기 때문에 함수가 실행되고 종료 되면 변수가 자동으로 가비지 컬렉션 된다.

## 마무리 🧐
자바스크립트에서 메모리 관리는 어떤 방식으로 이루어지며 성능 저하를 일으키는 메모리 누수를 방지하는 방법을 알아보았다.
메모리 누수에 대해 한번 더 생각하게 된 좋은 계기였다고 생각함
특히 순환참조 문제는 보통 모듈 의존성에서 많이 발생한다고 하는데 이 부분도 한번 공부할 예정이다.

## 참고자료
https://itnext.io/javascript-memory-management-how-to-avoid-common-memory-leaks-and-improve-performance-c018dbbca954